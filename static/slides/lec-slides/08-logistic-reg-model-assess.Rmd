---
title: "Logistic regression: model assessment and validation"
author: "Dr. Olanrewaju Michael Akande"
date: "Sept 19, 2019"
output:
  xaringan::moon_reader:
    css: "slides.css"
    logo: img/class_logo.png
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r packages, echo=FALSE, message=FALSE, warning=FALSE}
#library(tidyverse)
#library(magick)
library(knitr)
library(kableExtra)
library(lattice)
#library(dplyr)
library(MASS)
library(arm)
```

```{r setup, include=FALSE}
# R options
options(
  htmltools.dir.version = FALSE, # for blogdown
  #show.signif.stars = FALSE,     # for regression output
  warm = 1
  )
# Set dpi and height for images
knitr::opts_chunk$set(fig.height = 2.65,dpi =300,fig.align='center',fig.show='hold',size='footnotesize',small.mar=TRUE) 
# For nonsese...
htmltools::tagList(rmarkdown::html_dependency_font_awesome())
# For magick
dev.off <- function(){
  invisible(grDevices::dev.off())
}

knit_hooks$set(small.mar = function(before, options, envir) {
    if (before) par(mar =  c(4, 4, 1.5, 1.5)) 
})
```

<!-- ## Announcements -->

<!-- - Final project outline now online; check the course schedule on the course website -->

<!-- - Modified office hours today -->


## Outline

- Questions from last lecture

- Checking model fit:
  + Binned residuals
  + Confusion matrix
  + ROC curves

- Logistic regression with multiple predictors

- Change in deviance statistic



---
class: center, middle

# Checking model fit



---
## Logistic regression with multiple predictors: motivating example

- In many developing countries, people get their drinking water from wells.

--

- Sometimes these wells are contaminated with the chemical arsenic, which when consumed in high concentrations causes skin and bladder cancer, as well as cardiovascular disease.

--

- Fortunately, in many cases people living near contaminated wells have the opportunity to get water from nearby uncontaminated wells.



---
## The contaminated wells analysis

- In one study, several researchers measured the concentrations of arsenic in wells in a particular region of Bangladesh.

--

- They labeled wells as safe or unsafe based on the measurements.

--

- The researchers encouraged people drinking from unsafe wells to switch to safe wells.

--

- Several years later, the researchers returned to the area with the goal of seeing who had switched from unsafe to safe wells.

--

- They recorded information on a sample of 3020 individuals who had wells at their homes that were unsafe.

--

- Let's address the question: what predicts why people switch wells?

--

- The data is in the file `arsenic.csv` on Sakai.



---
## The contaminated wells analysis

Data description

Variable    | Description
:------------- | :------------
Switch | 1 = if respondent switched to a safe well <br /> 0 = if still using own unsafe well
Arsenic | amount of arsenic in well at respondent's home (100s of micrograms per liter)
Dist | distance in meters to the nearest known safe well
Assoc | 1 = if any members of household are active in community organizations <br /> 0 = otherwise
Educ | years of schooling of the head of household

Treat switch as the response variable and others as potential explanatory variables



---
## Logistic regression with multiple predictors:

We can then formally extend the .hlight[logistic regression model] we had before to allow for multiple predictors.

We still have
.block[
.small[
$$\Pr[y_i = 1 | x_i]  = \pi_i \ \ \textrm{and} \ \ \Pr[y_i = 0 | x_i] = 1-\pi_i,$$
]
]

or
.block[
.small[
$$y_i | x_i \sim \textrm{Bernoulli}(\pi_i)$$
]
]

as before, but with 
.block[
.small[
$$\textrm{log}\left(\dfrac{\pi_i}{1-\pi_i}\right) = \beta_0 + \beta_1 x_{i1} + \beta_2 x_{i2} + \ldots + \beta_p x_{ip}$$
]
]

now in both cases.


---
## Final notes

- Let's stop here today.

- In the next class, we will pick off from here and fit a logistic regression to the arsenic dataset.

- We will see how to do EDA when dealing with a binary response variable.

- We will also learn to do model assessment and validation for logistic models.



<!-- --- -->
<!-- ## The contaminated wells analysis: EDA -->

<!-- ```{r fig.height=3.4} -->
<!-- arsenic <- read.csv("data/arsenic.csv",header=T, -->
<!--                     colClasses=c("numeric","numeric","numeric","factor","numeric")) -->
<!-- head(arsenic) -->
<!-- summary(arsenic[,-1]) -->
<!-- table(arsenic$switch) -->
<!-- ``` -->


<!-- --- -->
<!-- ## The contaminated wells analysis: EDA -->

<!-- .hlight[Binned plots] are also quite informative when visualizing binary responses vs continuous predictors. First *switch* vs *arsenic*. -->

<!-- ```{r fig.height=3.4} -->
<!-- binnedplot(y=arsenic$switch,arsenic$arsenic,xlab="Arsenic",ylim=c(0,1), -->
<!--            ylab ="Switch cases",main="Binned Arsenic and Switch cases",col.int="white", -->
<!--            col.pts=c("red4","navy")) -->
<!-- ``` -->


<!-- --- -->
<!-- ## The contaminated wells analysis: EDA -->

<!-- Now, *switch* vs *dist*. -->

<!-- ```{r fig.height=3.3} -->
<!-- binnedplot(y=arsenic$switch,arsenic$dist,xlab="Distance",ylim=c(0,1), -->
<!--            ylab ="Switch cases",main="Binned Distance and Switch cases",col.int="white", -->
<!--            col.pts=c("red4","navy")) -->
<!-- ``` -->



<!-- --- -->
<!-- ## The contaminated wells analysis: EDA -->

<!-- Next, *switch* vs *educ*. -->

<!-- ```{r fig.height=3.3} -->
<!-- binnedplot(y=arsenic$switch,arsenic$educ,xlab="Education",ylim=c(0,1), -->
<!--            ylab ="Switch cases",main="Binned Education and Switch cases",col.int="white", -->
<!--            col.pts=c("red4","navy")) -->
<!-- ``` -->






<!-- --- -->
<!-- ## The contaminated wells analysis: EDA -->

<!-- ```{r fig.height=3,echo=F} -->
<!-- #boxplot(arsenic~switch,data=arsenic, xlab = "Switch", ylab = "Arsenic",col=c("red4","navy")) -->
<!-- par(mfrow=c(1,3),oma=c(0,0,0,0)) -->
<!-- boxplot(arsenic~switch,data=arsenic, ylab="Distance to nearest known safe well",pch = 25, -->
<!--         xlab="Switched to safe well?",col=c("yellow2","springgreen2"),xaxt='n', -->
<!--         pars = list(boxwex = 0.5, staplewex = 0.7, outwex = 0.5),cex = 0.85,main ="All") -->
<!-- axis(1,at=c(1,2),labels=c("No","Yes")) -->
<!-- boxplot(arsenic~switch,data=arsenic, subset= assoc == 1, ylab="Distance to nearest known safe well", -->
<!--         xlab="Switched to safe well?",col=c("yellow2","springgreen2"),xaxt='n', -->
<!--         pars = list(boxwex = 0.5, staplewex = 0.7, outwex = 0.5), -->
<!--         pch = 25, cex = 0.85,main ="Active in community") -->
<!-- axis(1,at=c(1,2),labels=c("No","Yes")) -->
<!-- boxplot(arsenic~switch,data=arsenic, subset= assoc == 0, ylab="Distance to nearest known safe well", -->
<!--         xlab="Switched to safe well?",col=c("yellow2","springgreen2"),xaxt='n', -->
<!--         pars = list(boxwex = 0.5, staplewex = 0.7, outwex = 0.5), -->
<!--         pch = 25, cex = 0.85,main ="Not active in community") -->
<!-- axis(1,at=c(1,2),labels=c("No","Yes")) -->
<!-- dev.off() -->

<!-- ``` -->




