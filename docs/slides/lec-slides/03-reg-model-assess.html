<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>MLR: model assessment, diagnostics and validation</title>
    <meta charset="utf-8" />
    <meta name="author" content="Dr. Olanrewaju Michael Akande" />
    <link href="libs/font-awesome/css/all.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <link rel="stylesheet" href="slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# MLR: model assessment, diagnostics and validation
### Dr. Olanrewaju Michael Akande
### Sept 3, 2019

---







## Outline

- Recap of last lecture

- Checking model assumptions

- Leverage, influence, and standardized residuals

- Prediction and validation

- Questions


---
## Introduction

- In the last class, we started our introduction to multiple linear regression. 

--

- We saw how to write down and fit MLR models. However, we ignored a very important part of fitting any model.

--

- We need to assess whether or not the assumptions of the model actually hold for the data at hand. That's exactly what we will dive in today.

--

- We will also cover model validation via in-sample and out-of-sample predictions.

--

- In the next class, we will move on to transformations (which we will touch on a bit today), multicollinearity and heteroscedasticity.


---
class: center, middle

# Assumptions for MLR


---
## Assumptions for MLR?

- Inference (CIs, p-values, or predictions) can only be meaningful when the regression assumptions are plausible.

- &lt;div class="question"&gt;
Can you list the assumptions for MLR?
&lt;/div&gt;

--

- The main assumptions are:

--

  1. Validity

--

  2. Linearity

--

  3. Independence of errors

--

  4. Equal variance

--

  5. Normality


---
## Checking assumptions

- The validity assumption is about whether the data and model are even suitable for answering the research question. 

--

- To quote the Gelman and Hill book,

  .block[
  "Optimally, this means that the outcome measure should accurately reflect the phenomenon of interest, the model should include all relevant predictors, and the model should generalize to cases to which it will be applied. 
  
  For example, a model of earnings will not necessarily tell you about pattern of total assets, neither will a model of test scores necessarily tell you about child intelligence or cognitive development."
  ]

--

- For this assumption, you should always keep in mind, the types of questions you can and cannot answer reliably from both the data and the model.


---
## Checking assumptions

- Checking assumptions 2 - 5 usually requires examining the residuals after model fitting.

--

- For linearity, usually, a plot of the residuals versus each predictor will do.

--

  &lt;div class="question"&gt;
What should we look out for in such a plot?
&lt;/div&gt;

--

- Note that the residuals contain information about the response variable variable `\(y\)` that has not been explained by the covariates in the model.

--

- Thus, when we plot the residuals against each predictor, we should NOT expect to see any pattern.

--

- .block[
Some pattern in any of the plots is usually an indication of a relationship between `\(y\)` and that predictor, which has not been captured yet in the model.
]


---
## Checking assumptions

- To check both independence of the errors and the equal variance assumption, usually a plot of the residuals versus the fitted values will do.

--

- .block[
The points in the plot should look random (for independence) and be "roughly" equally spread out around zero (for equal variance).
]

--

- To check normality, it is often sufficient to look at a qq-plot (quantile-quantile plot) which compares the distribution of the standardized residuals to the theoretical quantiles of a standard normal distribution.

--

- .block[
Linearity of the points around the 45 degree line of the qq-plot would suggest the normality assumption is not violated.
]

--

- One can also look at a histogram of the residuals, but it is much harder to judge deviations from normality through histograms.


---
## Checking assumptions

For example, let's revisit the same data from last class. Recall the model we fit to the data and the results:
.small[
`$$\textrm{Avg. bsal} = \textrm{Intercept} + \beta_1 \textrm{sex} + \beta_2 \textrm{senior} + \beta_3 \textrm{age} + \beta_4 \textrm{educ} + \beta_5 \textrm{exper}$$`
]


```
## 
## Call:
## lm(formula = bsal ~ sex + senior + age + educ + exper, data = wages)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1217.36  -342.83   -55.61   297.10  1575.53 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 6277.8934   652.2713   9.625 2.36e-15 ***
## sexFemale   -767.9127   128.9700  -5.954 5.39e-08 ***
## senior       -22.5823     5.2957  -4.264 5.08e-05 ***
## age            0.6310     0.7207   0.876 0.383692    
## educ          92.3060    24.8635   3.713 0.000361 ***
## exper          0.5006     1.0553   0.474 0.636388    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 508.1 on 87 degrees of freedom
## Multiple R-squared:  0.5152,	Adjusted R-squared:  0.4873 
## F-statistic: 18.49 on 5 and 87 DF,  p-value: 1.811e-12
```

---
## Checking linearity

Now, let's plot the residuals against each predictor. First, let's look at `senior`.

```r
plot(y=regwage$residual, x = wages$senior, xlab = "Seniority", ylab = "Residual")
abline(0,0)
```

&lt;img src="03-reg-model-assess_files/figure-html/unnamed-chunk-3-1.png" style="display: block; margin: auto;" /&gt;

--
&lt;div class="question"&gt;
Do you see any clear violations of the linearity assumption?
&lt;/div&gt;


---
## Checking linearity

Next, let's look at `age`.

```r
plot(y=regwage$residual, x = wages$age, xlab = "Age", ylab = "Residual")
abline(0,0)
```

&lt;img src="03-reg-model-assess_files/figure-html/unnamed-chunk-4-1.png" style="display: block; margin: auto;" /&gt;

--
&lt;div class="question"&gt;
Do you see any clear violations of the linearity assumption?
&lt;/div&gt;


---
## Checking linearity

Next, let's look at `educ`.

```r
plot(y=regwage$residual, x = wages$educ, xlab = "Education", ylab = "Residual")
abline(0,0)
```

&lt;img src="03-reg-model-assess_files/figure-html/unnamed-chunk-5-1.png" style="display: block; margin: auto;" /&gt;

--
&lt;div class="question"&gt;
Do you see any clear violations of the linearity assumption?
&lt;/div&gt;


---
## Checking linearity

Next, let's look at `exper`.

```r
plot(y=regwage$residual, x = wages$exper, xlab = "Experience", ylab = "Residual")
abline(0,0)
```

&lt;img src="03-reg-model-assess_files/figure-html/unnamed-chunk-6-1.png" style="display: block; margin: auto;" /&gt;

--
&lt;div class="question"&gt;
Do you see any clear violations of the linearity assumption?
&lt;/div&gt;


---
## Checking independence and equal variance


```r
plot(regwage,which=1)
```

&lt;img src="03-reg-model-assess_files/figure-html/unnamed-chunk-7-1.png" style="display: block; margin: auto;" /&gt;

--
&lt;div class="question"&gt;
Do you see any clear violations of the independence and equal variance assumptions?
&lt;/div&gt;


---
## Checking normality


```r
plot(regwage,which=2)
```

&lt;img src="03-reg-model-assess_files/figure-html/unnamed-chunk-8-1.png" style="display: block; margin: auto;" /&gt;

--
&lt;div class="question"&gt;
Do you see any clear violations of the normality assumption?
&lt;/div&gt;


---
## Takeaways from residual plots

- Looks like we may have to worry about the assumption of linearity being violated for age and experience.

- There appears to be some quadratic trend for both variables, so let's improve the model by adding the squared term for each variable. 

- First, let's mean-center the continuous predictor to improve interpretation of outputs (especially the intercept).

- Centering does not really improve model fit, however it does help with multicollinearity (which we will dive into properly in the next class).

- Essentially, a transformed variable `\(x_j^2\)` may be highly correlated with the untransformed counterpart `\(x_j\)`, which we want to avoid. Centering `\(x_j\)` before taking the square helps with that.


---
## Advice to aid interpretation

- Intercepts are often hard to interpret, because they represent value when all predictors equal zero. This may be an unrealistic or uninteresting case.

- Instead, for each continuous predictor, subtract its mean from every value. Use these mean centered predictors in regression

- Intercept interpreted as average value of Y at the average value of X, which is much more interpretable.

- From now on, we mean center continuous predictors.

---
### 


```r
plot(regwage,which=4)
```

&lt;img src="03-reg-model-assess_files/figure-html/unnamed-chunk-9-1.png" style="display: block; margin: auto;" /&gt;


---
### 


```r
plot(regwage,which=5)
```

&lt;img src="03-reg-model-assess_files/figure-html/unnamed-chunk-10-1.png" style="display: block; margin: auto;" /&gt;


---
### 


```r
plot(regwage,which=6)
```

&lt;img src="03-reg-model-assess_files/figure-html/unnamed-chunk-11-1.png" style="display: block; margin: auto;" /&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
